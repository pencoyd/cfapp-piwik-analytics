// Generated by CoffeeScript 1.6.2
/*
# piwik_analytics module definition
# REQUIRE:
#   -- defaults to {} and will assign test defaults
#  cloudflare/console for output to console
*/
CloudFlare.define('piwik_analytics', ['cloudflare/console', 'piwik_analytics/perf', 'piwik_analytics/setup', 'piwik_analytics/piwik_js'], function(__console, __perf, __setup, __js) {
  var e, myPiwik, __config;

  try {
    if (__setup._debug === true) {
      __console.log((__perf.now() - __setup.perfThen) + " ms" + "\t since \"piwik_analytics/setup\" Factory execution time");
    }
  } catch (_error) {
    e = _error;
    __console.error("uhoh " + e);
  }
  __config = {};
  myPiwik = {};
  myPiwik.perfThen = __perf.now();
  window._paq = window._paq || [];
  /*
  # myPiwik.getVisitorId
  # pushes a request for the Piwik VisitorId generated once piwik.js executes
  # sets the _visitorId to be the id, and returns it's value
  # will return the visitorId or false if piwik.js is still not loaded.
  #
  */

  myPiwik.getVisitorId = function() {
    var _visitorId;

    _visitorId = false;
    window._paq.push([
      function() {
        _visitorId = this.getVisitorId();
        if (typeof _debug !== "undefined" && _debug !== null) {
          __console.log("Piwik.getVisitorId = " + _visitorId);
        }
        return _visitorId;
      }
    ]);
    return _visitorId;
  };
  /*
  # myPiwik.menuOpts
  */

  myPiwik.menuOpts = function() {
    var wildcardZone;

    if (__config.tracking_all_subdomains === "true" || __config.tracking_all_subdomains === void 0) {
      wildcardZone = "*" + document.domain.split(".").slice(-2).join(".");
      window._paq.push(["setCookieDomain", wildcardZone]);
    }
    if (__config.tracking_do_not_track === "true" || __config.tracking_do_not_track === void 0) {
      window._paq.push(['setDoNotTrack', true]);
    } else {
      window._paq.push(['setDoNotTrack', false]);
    }
    return window._paq;
  };
  /*
  # myPiwik.paqPush()
  #     take options from a Piwik configuration
  #       We could have multiple trackers someday! TODO
  #      It's easy, just not supported in this App.
  #    push our Piwik options into the window._paq array
  #     send a trackPageView to the TrackerUrl
  */

  myPiwik.paqPush = function() {
    if ((!__config.paq_push) && (__config.paq_push !== void 0) && (__config.paq_push !== "")) {
      window._paq.push(unescape(__config.paq_push));
    }
    window._paq.push(['enableLinkTracking', true]);
    window._paq.push(['trackPageView']);
    return window._paq;
  };
  try {
    myPiwik.menuOpts();
  } catch (_error) {
    e = _error;
    __console.error("uhoh " + e);
  }
  try {
    myPiwik.paqPush();
  } catch (_error) {
    e = _error;
    __console.error("uhoh " + e);
  }
  if (typeof _debug !== "undefined" && _debug !== null) {
    __console.log((__perf.now() - myPiwik.perfThen) + " ms" + "\t piwik_ananlytics Factory execution time");
    CloudFlare.require(['piwik_analytics/showPerf']);
    try {
      myPiwik.getVisitorId();
    } catch (_error) {
      e = _error;
      __console.error("uhoh " + e);
    }
  }
  return myPiwik;
});

/*
#end myPiwik module
*/

